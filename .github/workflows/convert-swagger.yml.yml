name: Convert Swagger to OpenAPI

on:
  pull_request:
    paths:
      - 'swagger.json'
      - 'swagger.yaml'
  push:
    branches:
      - main
    paths:
      - 'swagger.json'
      - 'swagger.yaml'

permissions:
  contents: write
  pull-requests: write

jobs:
  convert-swagger:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.head_ref || github.ref }}
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Convert Swagger to OpenAPI
        uses: stainless-api/upload-openapi-spec-action/prepare/swagger@v1
        with:
          # Path to your Swagger 2.0 spec file
          input_path: ./swagger.json

          # Path where the converted OpenAPI 3.x spec will be written
          output_path: ./openapi.json

          # Fix up small errors in the source definition
          patch: false

          # Resolve external references
          resolve: true

          # Target OpenAPI version: '3.0' or '3.1'
          target_version: '3.0'

          # Whether to commit the converted file
          commit: true

          # Commit message (only used if commit is true)
          commit_message: 'chore: convert Swagger 2.0 to OpenAPI 3.x'

          # GitHub token for committing
          github_token: ${{ secrets.GITHUB_TOKEN }}