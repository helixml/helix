# Default values for helix-controlplane.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""
  serverUrl: http://localhost:8080

image:
  repository: registry.helixml.tech/helix/controlplane
  pullPolicy: Always
  tag: "latest"

tika:
  enabled: false
  image:
    repository: apache/tika
    tag: "2.9.2.1"

searxng:
  enabled: true
  image:
    repository: searxng/searxng
    tag: "latest"

chrome:
  enabled: true
  image:
    repository: ghcr.io/go-rod/rod
    tag: "v0.115.0"

typesense:
  enabled: false
  apiKey: typesense
  image:
    repository: registry.helixml.tech/helix/typesense
  persistence:
    enabled: true
    storageClass: ""
    annotations: {}
    accessModes:
      - ReadWriteOnce
    size: 8Gi
    existingClaim: ""
    selector: {}
    dataSource: {}

pgvector:
  enabled: true
  auth:
    username: "postgres"
    password: "pgvector"
    database: "postgres"
    existingSecret: ""
    usernameKey: ""
    passwordKey: ""
    databaseKey: ""
  external:
    host: "localhost"
    port: 5432
    database: "postgres"
    user: "postgres"
    password: "pgvector"
    existingSecret: ""
    existingSecretHostKey: ""
    existingSecretPortKey: ""
    existingSecretUserKey: ""
    existingSecretDatabaseKey: ""
    existingSecretPasswordKey: ""
    annotations: {}
  persistence:
    enabled: true
    storageClass: ""
    annotations: {}
    accessModes:
      - ReadWriteOnce
    size: 8Gi
    existingClaim: ""
    selector: {}
    dataSource: {}

controlplane:
  logLevel: "INFO"
  runnerToken: ""
  runnerTokenExistingSecret: ""
  runnerTokenExistingSecretKey: ""
  licenseKey: ""
  licenseKeyExistingSecret: ""
  licenseKeyExistingSecretKey: ""
  # Used for sending emails like password reset, agent notifications, etc.
  smtp:
    enabled: false
    host: ""
    port: 587
    username: ""
    password: ""
    from: ""
    to: ""
  # Can be regular (inbuilt auth), keycloak (external auth) or oidc (external auth)
  authProvider: "regular"  
  keycloak:
    enabled: false
    url: ""
    frontendUrl: ""
    user: ""
    password: ""
    existingSecret: ""
    existingSecretUserKey: ""
    existingSecretPasswordKey: ""
  admin:
    userSource: "env"
    userIds: "all"
  # AI Providers management - controls if users can add their own AI provider API keys
  providersManagementEnabled: true
  sidecar:
    enabled: false
    name: sidecar
    image: curlimages/curl:8.11.1
    imagePullPolicy: IfNotPresent
    command:
      - "/bin/sh"
      - "-c"
    args:
      - 'echo "Hello World"'
  haystack:
    enabled: false
    image:
      repository: registry.helixml.tech/helix/haystack
    embeddingsModel: "MrLight/dse-qwen2-2b-mrl-v1"
    embeddingsDim: "1536"
    chunkSize: "1000"
    chunkOverlap: "50"
  providers:
    vllm:
      baseUrl: ""
      apiKey: ""
      existingSecret: ""
      existingSecretApiKeyKey: ""
    openai:
      baseUrl: ""
      apiKey: ""
      existingSecret: ""
      existingSecretApiKeyKey: ""
    anthropic:
      baseUrl: ""
      apiKey: ""
      existingSecret: ""
      existingSecretApiKeyKey: ""
    togetherai:
      baseUrl: ""
      apiKey: ""
      existingSecret: ""
      existingSecretApiKeyKey: ""
  huggingface:
    token: ""
    existingSecret: ""
    existingSecretTokenKey: ""
  extraEnv: []
  kodit: {}
    # baseURL: # Defaults to http://{{ .Release.Name }}-kodit:8080
    # gitURL: # Defaults to http://{{ .Release.Name }}:80

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext: {}

securityContext: {}

service:
  type: ClusterIP
  port: 80

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []

resources: {}

livenessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 10
  failureThreshold: 6
readinessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 10
  failureThreshold: 6

persistence:
  enabled: true
  mountPath: /helix/controlplane
  subPath: ""
  gitDataPath: ""
  storageClass: ""
  annotations: {}
  accessModes:
    - ReadWriteOnce
  size: 8Gi
  existingClaim: ""
  selector: {}
  dataSource: {}

nodeSelector: {}

tolerations: []

affinity: {}

postgresql:
  enabled: true
  image:
    registry: docker.io
    repository: bitnamilegacy/postgresql
    tag: "latest"
    pullPolicy: IfNotPresent
  auth:
    postgresPassword: ""
    username: helix
    password: "oh-hallo-insecure-password"
    database: helix
    existingSecret: ""
    postgresPasswordKey: "postgres-password"
    usernameKey: ""
    passwordKey: ""
    databaseKey: ""
  architecture: standalone
  external:
    host: ""
    port: 5432
    user: helix
    database: helix
    password: ""
    existingSecret: ""
    existingSecretHostKey: ""
    existingSecretPortKey: ""
    existingSecretUserKey: ""
    existingSecretDatabaseKey: ""
    existingSecretPasswordKey: ""
    annotations: {}

# See https://github.com/helixml/kodit/blob/main/charts/kodit/values.yaml 
# and https://github.com/bjw-s-labs/helm-charts/blob/main/charts/library/common/values.yaml for all possible values.
kodit:
  enabled: true

  # Replace this with your own secret.
  secrets:
    kodit:
      enabled: true
      stringData:
        POSTGRES_USER: cG9zdGdyZXM=  # postgres gitleaks:allow
        POSTGRES_PASSWORD: bXlzZWNyZXRwYXNzd29yZA==  # mysecretpassword gitleaks:allow
        POSTGRES_DB: a29kaXQ=  # kodit gitleaks:allow

  controllers:
    kodit:
      containers:
        kodit:
          image:
            repository: registry.helixml.tech/helix/kodit
            tag: latest  # Replace with a version from https://github.com/helixml/kodit/releases.
          # Replace this with your own secret.
          envFrom:
            - secretRef:
                name: "{{ .Release.Name }}-kodit"
          env:
            # Please see https://docs.helixml.tech/kodit/reference/configuration/ for all possible values.
            DATA_DIR: /data
            DB_URL: postgresql+asyncpg://$(POSTGRES_USER):$(POSTGRES_PASSWORD)@{{ .Release.Name }}-kodit-vectorchord:5432/$(POSTGRES_DB)
            DEFAULT_SEARCH_PROVIDER: vectorchord

    vectorchord:
      enabled: true
      strategy: Recreate
      containers:
        vectorchord:
          image:
            repository: tensorchord/vchord-suite
            tag: pg17-20250601
            pullPolicy: IfNotPresent
          envFrom:
            - secretRef:
                name: "{{ .Release.Name }}-kodit"
  service:
    kodit:
      controller: kodit
      ports:
        http:
          port: 8080
    vectorchord:
      enabled: true
      controller: vectorchord
      ports:
        postgres:
          port: 5432

  persistence:
    kodit-data:
      enabled: true
      # existingClaim: kodit-data # RECOMMENDED
      size: 10Gi
      accessMode: ReadWriteOnce
      advancedMounts:
        kodit:
          kodit:
            - path: /data
    vectorchord-data:
      enabled: true
      # existingClaim: kodit-vectorchord # RECOMMENDED
      size: 10Gi
      accessMode: ReadWriteOnce
      advancedMounts:
        vectorchord:
          vectorchord:
            - path: /var/lib/postgresql/data
