# Default values for helix-controlplane.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""
  serverUrl: http://localhost:8080

image:
  repository: registry.helixml.tech/helix/controlplane
  pullPolicy: Always
  tag: "latest"

tika:
  enabled: false
  image:
    repository: apache/tika
    tag: "2.9.2.1"

searxng:
  enabled: true
  image:
    repository: searxng/searxng
    tag: "latest"

chrome:
  enabled: true
  image:
    repository: ghcr.io/go-rod/rod
    tag: "v0.115.0"

typesense:
  enabled: false
  apiKey: typesense
  image:
    repository: registry.helixml.tech/helix/typesense
  persistence:
    enabled: true
    storageClass: ""
    annotations: {}
    accessModes:
      - ReadWriteOnce
    size: 8Gi
    existingClaim: ""
    selector: {}
    dataSource: {}

pgvector:
  enabled: true
  auth:
    username: "postgres"
    password: "pgvector"
    database: "postgres"
    existingSecret: ""
    usernameKey: ""
    passwordKey: ""
    databaseKey: ""
  external:
    host: "localhost"
    port: 5432
    database: "postgres"
    user: "postgres"
    password: "pgvector"
    existingSecret: ""
    existingSecretHostKey: ""
    existingSecretPortKey: ""
    existingSecretUserKey: ""
    existingSecretDatabaseKey: ""
    existingSecretPasswordKey: ""
    annotations: {}
  persistence:
    enabled: true
    storageClass: ""
    annotations: {}
    accessModes:
      - ReadWriteOnce
    size: 8Gi
    existingClaim: ""
    selector: {}
    dataSource: {}

controlplane:
  logLevel: "INFO"
  runnerToken: ""
  runnerTokenExistingSecret: ""
  runnerTokenExistingSecretKey: ""
  # Encryption key for secrets at rest (SSH keys, PATs, etc.)
  # 64-character hex string (32 bytes for AES-256-GCM)
  # Generate with: openssl rand -hex 32
  encryptionKey: ""
  encryptionKeyExistingSecret: ""
  encryptionKeyExistingSecretKey: ""
  licenseKey: ""
  licenseKeyExistingSecret: ""
  licenseKeyExistingSecretKey: ""
  # Used for sending emails like password reset, agent notifications, etc.
  smtp:
    enabled: false
    host: ""
    port: 587
    username: ""
    password: ""
    from: ""
    to: ""
  # Can be regular (inbuilt auth), keycloak (external auth) or oidc (external auth)
  authProvider: "regular"  
  keycloak:
    enabled: false
    url: ""
    frontendUrl: ""
    user: ""
    password: ""
    existingSecret: ""
    existingSecretUserKey: ""
    existingSecretPasswordKey: ""
  admin:
    userSource: "env"
    userIds: "all"
  # AI Providers management - controls if users can add their own AI provider API keys
  providersManagementEnabled: true
  sidecar:
    enabled: false
    name: sidecar
    image: curlimages/curl:8.11.1
    imagePullPolicy: IfNotPresent
    command:
      - "/bin/sh"
      - "-c"
    args:
      - 'echo "Hello World"'
  haystack:
    enabled: false
    image:
      repository: registry.helixml.tech/helix/haystack
    embeddingsModel: "MrLight/dse-qwen2-2b-mrl-v1"
    embeddingsDim: "1536"
    chunkSize: "1000"
    chunkOverlap: "50"
  providers:
    vllm:
      baseUrl: ""
      apiKey: ""
      existingSecret: ""
      existingSecretApiKeyKey: ""
    openai:
      baseUrl: ""
      apiKey: ""
      existingSecret: ""
      existingSecretApiKeyKey: ""
    anthropic:
      baseUrl: ""
      apiKey: ""
      existingSecret: ""
      existingSecretApiKeyKey: ""
    togetherai:
      baseUrl: ""
      apiKey: ""
      existingSecret: ""
      existingSecretApiKeyKey: ""
  huggingface:
    token: ""
    existingSecret: ""
    existingSecretTokenKey: ""
  extraEnv: []
  kodit: {}
    # baseURL: # Defaults to http://{{ .Release.Name }}-kodit:8080
    # gitURL: # Defaults to http://{{ .Release.Name }}:80

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext: {}

terminationGracePeriodSeconds: 30

securityContext: {}

service:
  type: ClusterIP
  port: 80

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []

resources: {}

livenessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 10
  failureThreshold: 6
readinessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 10
  failureThreshold: 6

persistence:
  enabled: true
  mountPath: /helix/controlplane
  subPath: ""
  gitDataPath: ""
  storageClass: ""
  annotations: {}
  accessModes:
    - ReadWriteOnce
  size: 8Gi
  existingClaim: ""
  selector: {}
  dataSource: {}

nodeSelector: {}

tolerations: []

affinity: {}

postgresql:
  enabled: true
  image:
    registry: docker.io
    repository: bitnamilegacy/postgresql
    tag: "latest"
    pullPolicy: IfNotPresent
  auth:
    postgresPassword: ""
    username: helix
    password: "oh-hallo-insecure-password"
    database: helix
    existingSecret: ""
    postgresPasswordKey: "postgres-password"
    usernameKey: ""
    passwordKey: ""
    databaseKey: ""
  architecture: standalone
  external:
    host: ""
    port: 5432
    user: helix
    database: helix
    password: ""
    existingSecret: ""
    existingSecretHostKey: ""
    existingSecretPortKey: ""
    existingSecretUserKey: ""
    existingSecretDatabaseKey: ""
    existingSecretPasswordKey: ""
    annotations: {}

# Kodit configuration - Code indexing service
# Kodit provides code search and analysis capabilities for Helix
kodit:
  enabled: true

  # Kodit application image
  image:
    repository: registry.helixml.tech/helix/kodit
    tag: "0.5.16"
    pullPolicy: IfNotPresent

  # Database authentication (for kodit's vectorchord database)
  auth:
    username: "postgres"
    password: "kodit-password"
    database: "kodit"
    # Option: Use existing secret for all auth credentials
    existingSecret: ""
    usernameKey: ""   # defaults to "username"
    passwordKey: ""   # defaults to "password"
    databaseKey: ""   # defaults to "database"

  # Enrichment endpoint configuration (Kodit uses Helix as LLM proxy)
  enrichment:
    # Base URL for enrichment API (defaults to Helix controlplane)
    baseUrl: ""  # Defaults to http://<fullname>:80/v1
    model: "openai/kodit-model"
    parallelTasks: "3"
    timeout: "120"
    # API key for enrichment endpoint
    apiKey: ""
    # Option: Use existing secret for API key (recommended - use runner token secret)
    existingSecret: ""
    existingSecretKey: ""  # defaults to "api-token"

  # Persistence for kodit data
  persistence:
    enabled: true
    size: "10Gi"
    storageClass: ""
    annotations: {}
    accessModes:
      - ReadWriteOnce
    existingClaim: ""
    selector: {}
    dataSource: {}

  # Vectorchord (PostgreSQL + pgvector) configuration for kodit
  vectorchord:
    enabled: true
    image:
      repository: tensorchord/vchord-suite
      tag: pg17-20250601
      pullPolicy: IfNotPresent
    persistence:
      enabled: true
      size: "10Gi"
      storageClass: ""
      annotations: {}
      accessModes:
        - ReadWriteOnce
      existingClaim: ""
      selector: {}
      dataSource: {}
