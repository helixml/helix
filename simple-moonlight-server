#!/bin/bash
# Simple Moonlight-compatible HTTP server for external screencopy

PORT=47989
HTTPS_PORT=47984

echo "ðŸŒ™ Simple Moonlight Server v1.0"
echo "Starting HTTP server on port $PORT"
echo "Starting HTTPS server on port $HTTPS_PORT"

# Simple HTTP responses for Moonlight protocol
start_http_server() {
    while true; do
        echo -e "HTTP/1.1 200 OK\r\nContent-Type: application/xml\r\n\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?><root status_code=\"200\"><hostname>Hyprland</hostname><appversion>7.1.431.-1</appversion><GfeVersion>3.23.0.74</GfeVersion><uniqueid>simple-moonlight-server</uniqueid><MaxLumaPixelsHEVC>1869449984</MaxLumaPixelsHEVC><ServerCodecModeSupport>257</ServerCodecModeSupport><HttpsPort>47984</HttpsPort><ExternalPort>47989</ExternalPort><mac>00:00:00:00:00:00</mac><LocalIP>127.0.0.1</LocalIP><SupportedDisplayMode><DisplayMode><Width>1920</Width><Height>1080</Height><RefreshRate>60</RefreshRate></DisplayMode></SupportedDisplayMode><PairStatus>0</PairStatus><currentgame>0</currentgame><state>SUNSHINE_SERVER_FREE</state></root>" | nc -l -p $PORT
    done
}

# Start HTTP server in background
start_http_server &

echo "âœ… Simple Moonlight server running"
echo "ðŸ“¡ Access via: http://localhost:$PORT/serverinfo"

# Keep running
tail -f /dev/null