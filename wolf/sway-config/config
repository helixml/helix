# Helix Personal Dev Environment custom Sway configuration
# This gets included EARLY by GOW base config (before $mod is defined)
# Therefore: NO bindsym commands here! Add those to startup-app.sh instead.
#
# ===================================================================
# TESTING INSTRUCTIONS - SwayFX DRM Device Conflict Resolution
# ===================================================================
#
# This config has been hardened to prevent DRM device conflicts that cause:
# "legacy_drm_handle_device: Assertion `wl->drm_render_name == NULL' failed"
#
# To test configuration changes:
#
# 1. Rebuild Sway image after modifying this file:
#    ./stack build-sway
#
# 2. Restart Wolf to pick up new image:
#    docker compose -f docker-compose.dev.yaml down wolf
#    docker compose -f docker-compose.dev.yaml up -d wolf
#
# 3. Create a new PDE or External Agent session (existing containers won't update)
#
# 4. Check logs for diagnostics:
#    docker compose -f docker-compose.dev.yaml logs wolf | tail -50
#
# 5. Look for:
#    - "=== DRM Device Diagnostics ===" showing available devices
#    - Sway startup messages
#    - If crash: Error handler message + container stays alive
#
# 6. If container crashes anyway, check Wolf logs for assertion details:
#    docker compose -f docker-compose.dev.yaml logs wolf | grep -A5 -B5 "Assertion"
#
# TROUBLESHOOTING:
# - If multiple renderD* devices appear: GPU conflict, check docker-compose.dev.yaml
# - If "ERROR: Sway compositor crashed": Check which config option you re-enabled
# - Container now stays alive after crashes for `docker exec` debugging
#
# ===================================================================

# Disable Xwayland - force native Wayland for all apps (fixes Zed input issues with NVIDIA)
xwayland disable

# Set Helix wallpaper
output * bg /usr/share/backgrounds/helix-logo.png fill

# Configure HiDPI scaling for display WL-1
output WL-1 scale 1.5

# ===================================================================
# SwayFX Visual Effects (MAXIMUM VISUAL IMPACT)
# ===================================================================
#
# IMPORTANT: Not all SwayFX features work in containerized/GPU-passthrough environments!
#
# SAFE features (tested working):
#   - Global blur effects (blur enable, blur_passes, blur_radius, etc.)
#   - Shadow effects (shadows enable, shadow_blur_radius, etc.)
#   - Corner radius (corner_radius)
#   - Dim inactive windows (default_dim_inactive)
#
# RISKY features (cause DRM device conflicts):
#   - layer_effects with blur_xray (creates separate GPU context)
#   - Output-specific configurations for non-existent displays (output WL-1)
#   - Multiple blur contexts (global + layer-specific)
#
# If Sway crashes with "wl->drm_render_name == NULL", disable layer_effects first.
# ===================================================================

# # Enhanced Blur Effects - High quality with depth
# blur enable

# # Maximum quality blur (0-10 range)
# blur_passes 8

# # Strong blur effect (0-10 range)
# blur_radius 7

# # Subtle texture to prevent banding
# blur_noise 0.03

# # Slightly dimmed for depth perception
# blur_brightness 0.95

# # Enhanced contrast for clarity
# blur_contrast 1.1

# # Richer, more vibrant colors
# blur_saturation 1.1

# # Stack blurs for layered depth effect
# blur_xray disable

# # Larger radius for modern macOS-like appearance
# corner_radius 12

# # Enhanced Window Shadows - Highly visible with depth
# shadows enable

# # Shadows on client-side decorations
# shadows_on_csd enable

# # Large, soft shadows (0-99 range)
# shadow_blur_radius 10

# # Dark shadow, 67% opacity for visibility
# shadow_color #000000AA

# # Shadow positioned below windows for depth
# shadow_offset 0 8

# # Dimmed shadows for unfocused windows
# shadow_inactive_color #00000055

# # Dim Unfocused Windows - Clear visual hierarchy
# # 40% dimming for inactive windows
# default_dim_inactive 0.4

# # Subtle dark overlay
# dim_inactive_colors.unfocused #00000066

# # Red tint for urgent windows
# dim_inactive_colors.urgent #900000FF

# # Remove separator between titlebar and content
# titlebar_separator disable

# # Enhanced Waybar Effects - Premium status bar appearance
# # DISABLED: layer_effects with blur_xray creates a SEPARATE GPU rendering context
# # This causes Sway to initialize a second DRM device, triggering:
# # "legacy_drm_handle_device: Assertion `wl->drm_render_name == NULL' failed"
# #
# # The blur_xray option is specifically problematic as it creates an independent
# # render pipeline for the layer. Even without blur_xray, having layer-specific
# # blur alongside global blur can cause DRM conflicts in containerized environments.
# #
# # layer_effects "waybar" {
# #     blur enable
# #     blur_xray enable
# #     blur_ignore_transparent enable
# #     shadows enable
# #     corner_radius 10
# # }

# # ===================================================================
# # Window Dragging and Resizing (Mouse Interaction)
# # ===================================================================

# # Enable Alt+click dragging for all windows (both floating and tiling)
# # Alt+Left-click: Drag window to move
# # Alt+Right-click: Drag to resize from ANY POINT on window (not just borders!)
# # NOTE: Sway has NO "resize grab area" setting - border thickness is purely visual.
# # Use Alt+Right-click for easy resizing instead of trying to target tiny border edges.
# floating_modifier Mod1 normal

# # Moderate border thickness for visibility (not resize targeting)
# default_border pixel 3

# # Floating windows get normal borders with title bars
# default_floating_border normal

# # Visual gaps between windows to improve resize targeting
# # Space between adjacent windows
# gaps inner 6

# # Space at screen edges
# gaps outer 2

# # Smart border behavior: hide when single window, show when multiple
# # Provides clean look for focused work, organized look for multitasking
# smart_borders no_gaps

# # ===================================================================
# # Floating Window Configuration (Traditional Desktop Behavior)
# # ===================================================================

# # Make all windows float by default (disable auto-tiling)
# # for_window [class=".*"] floating enable
# # for_window [app_id=".*"] floating enable

# # Show title bars for click-and-drag without modifier keys
# # default_border normal

# # Customize title bar appearance to match SwayFX theme
# # titlebar_padding 5
# # titlebar_border_thickness 2

# # Note: Key bindings and floating_modifier are added in startup-app.sh (after $mod is defined)
